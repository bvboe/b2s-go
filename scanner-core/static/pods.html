<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bjorn2scan - Pods</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="multi-select-styles.css">
    <link rel="stylesheet" href="custom-styles.css">
</head>
<body>
    <table width="100%">
        <tr>
            <td valign="top">
                <table id="headerTable">
                    <thead></thead>
                    <tbody id="sidebarNav">
                        <!-- Sidebar navigation will be populated here -->
                    </tbody>
                </table>
            </td>
            <td width="100%" valign="top">
                <h1><div id="clusterName">bjorn2scan</div></h1>

                <table style="border-collapse: collapse;" width="100%" id="filterTable">
                    <thead>
                        <tr>
                            <td width="1%" style="cursor: pointer" onclick="toggleFilterVisible()" class="filterSelected" id="filterCell">
                                <b><div class="filterContainerSelected" id="filterContainer">Filters</div></b>
                            </td>
                            <td colspan="1"></td>
                        </tr>
                    </thead>
                    <tbody id="filterDetails">
                        <tr height="1px">
                            <td style="border-left: 1px solid black;"/>
                            <td style="border-top: 1px solid black; border-right: 1px solid black;"/>
                        </tr>
                        <tr>
                            <td colspan="2" class="filterBody">
                                <form>
                                    <label for="namespaceFilter"><b>Namespace:</b></label>
                                    <select id="namespaceFilter" name="namespaces" multiple onchange="onFilterChange()">
                                    </select>

                                    <label for="vulnerabilityStatusFilter"><b>Vulnerability Status:</b></label>
                                    <select id="vulnerabilityStatusFilter" name="vulnerabilityStatus" multiple onchange="onFilterChange()">
                                    </select>

                                    <label for="packageTypeFilter"><b>Vulnerable Package Type:</b></label>
                                    <select id="packageTypeFilter" name="packageType" multiple onchange="onFilterChange()">
                                    </select>

                                    <label for="osNameFilter"><b>OS Distribution:</b></label>
                                    <select id="osNameFilter" name="osName" multiple onchange="onFilterChange()">
                                    </select>
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div style="text-align: right; text-decoration: underline;">
                    <b><a href="" id="csvlink">Export to CSV</a></b>
                </div>

                <table id="vulnerabilityTable" width="100%" class="listingTable">
                    <thead>
                        <tr>
                            <th rowspan="2" class="sortable" data-sort-field="namespace" onclick="sortByColumn('namespace')"><b>Namespace</b></th>
                            <th rowspan="2" class="sortable" data-sort-field="pod" onclick="sortByColumn('pod')"><b>Pod</b></th>
                            <th rowspan="2" class="sortable" data-sort-field="container" onclick="sortByColumn('container')"><b>Container</b></th>
                            <th colspan="6"><b>Vulnerabilities</b></th>
                            <th rowspan="2" class="sortable" data-sort-field="total_risk" onclick="sortByColumn('total_risk')"><b>Risk Score</b></th>
                            <th rowspan="2" class="sortable" data-sort-field="exploit_count" onclick="sortByColumn('exploit_count')"><b>Known Exploits</b></th>
                            <th rowspan="2" class="sortable" data-sort-field="package_count" onclick="sortByColumn('package_count')"><b># Packages</b></th>
                        </tr>
                        <tr>
                            <th class="sortable" data-sort-field="critical_count" onclick="sortByColumn('critical_count')"><b>Critical</b></th>
                            <th class="sortable" data-sort-field="high_count" onclick="sortByColumn('high_count')"><b>High</b></th>
                            <th class="sortable" data-sort-field="medium_count" onclick="sortByColumn('medium_count')"><b>Medium</b></th>
                            <th class="sortable" data-sort-field="low_count" onclick="sortByColumn('low_count')"><b>Low</b></th>
                            <th class="sortable" data-sort-field="negligible_count" onclick="sortByColumn('negligible_count')"><b>Negligible</b></th>
                            <th class="sortable" data-sort-field="unknown_count" onclick="sortByColumn('unknown_count')"><b>Unknown</b></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>

                <div id="pagination" style="margin: 20px 0; text-align: center;">
                    <!-- Pagination controls will be inserted here -->
                </div>

                <div id="app-footer"></div>
            </td>
        </tr>
    </table>

    <script src="shared.js"></script>
    <script>
        // Page-specific configuration for pods.html
        initSharedPage({
            apiEndpoint: '/api/pods',
            dataKey: 'pods',
            pageTitle: 'Pods',
            currentPageUrl: 'pods.html',
            defaultSortBy: 'namespace',
            columnCount: 12,
            renderRow: function(row, item) {
                // Add namespace
                addCellToRow(row, 'left', item.namespace || '');

                // Add pod name
                addCellToRow(row, 'left', item.pod || '');

                // Add container name
                addCellToRow(row, 'left', item.container || '');

                // Check if scan is complete
                if (isScanComplete(item.status_description)) {
                    // Show vulnerability counts
                    addCellToRow(row, 'right', formatNumber(item.critical_count));
                    addCellToRow(row, 'right', formatNumber(item.high_count));
                    addCellToRow(row, 'right', formatNumber(item.medium_count));
                    addCellToRow(row, 'right', formatNumber(item.low_count));
                    addCellToRow(row, 'right', formatNumber(item.negligible_count));
                    addCellToRow(row, 'right', formatNumber(item.unknown_count));
                    addCellToRow(row, 'right', formatRiskNumber(item.total_risk));
                    addCellToRow(row, 'right', formatNumber(item.exploit_count));
                    addCellToRow(row, 'right', formatNumber(item.package_count));
                } else {
                    // Show status message spanning all vulnerability columns
                    const cell = addCellToRow(row, 'left', item.status_description || 'Unknown status');
                    cell.colSpan = 9;
                }
            }
        });

        // Load page when DOM is ready
        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>
