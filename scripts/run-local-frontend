#!/usr/bin/env bash
set -e

# Determine repository root (works from any directory in the repo)
REPO_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
cd "$REPO_ROOT"

# Colors for output
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${BLUE}================================================${NC}"
echo -e "${BLUE}bjorn2scan - Local Frontend Development Server${NC}"
echo -e "${BLUE}================================================${NC}"
echo ""
echo -e "${YELLOW}Prerequisites:${NC}"
echo "  1. Backend must be running with port-forward enabled:"
echo "     kubectl port-forward svc/bjorn2scan 8080:80 -n <namespace>"
echo "     OR: Use scripts/port-forward"
echo ""
echo "  2. Docker must be running"
echo ""
echo -e "${GREEN}Starting local frontend server...${NC}"
echo ""
echo -e "${GREEN}Frontend will be available at: http://localhost:9000${NC}"
echo -e "${GREEN}API calls will be proxied to: localhost:8080${NC}"
echo ""
echo -e "${BLUE}Press Ctrl+C to stop${NC}"
echo ""

# Run nginx with mounted web directory and config
docker run --rm \
    -v "$REPO_ROOT/scanner-core/web:/usr/share/nginx/html:ro" \
    -v "$REPO_ROOT/scanner-core/web/dev-nginx.conf:/etc/nginx/nginx.conf:ro" \
    -p 9000:8080 \
    --name bjorn2scan-frontend-dev \
    cgr.dev/chainguard/nginx:latest
