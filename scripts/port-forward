#!/usr/bin/env bash
set -e

# Determine repository root (works from any directory in the repo)
REPO_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
cd "$REPO_ROOT"

# Configuration
SERVICE_NAME="${SERVICE_NAME:-bjorn2scan}"
LOCAL_PORT="${LOCAL_PORT:-8080}"
REMOTE_PORT="${REMOTE_PORT:-80}"

# Get current namespace from kubectl context
CURRENT_NS=$(kubectl config view --minify --output 'jsonpath={..namespace}' 2>/dev/null)
NAMESPACE="${NAMESPACE:-${CURRENT_NS:-default}}"

# Colors for output
GREEN='\033[0;32m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo -e "${BLUE}Port forwarding to service ${SERVICE_NAME} in namespace ${NAMESPACE}${NC}"
echo -e "${GREEN}Access at: http://localhost:${LOCAL_PORT}${NC}"
echo -e "${BLUE}Press Ctrl+C to stop${NC}"
echo ""

# Forward to service
exec kubectl port-forward -n "$NAMESPACE" "svc/$SERVICE_NAME" "$LOCAL_PORT:$REMOTE_PORT"
