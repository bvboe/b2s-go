# Bjorn2Scan Agent Configuration File
# Copy this file to /etc/bjorn2scan/agent.conf or ./agent.conf
# Environment variables override values in this file

# Server port (default: 9999)
# Environment variable: PORT
port=9999

# Database path (default: /var/lib/bjorn2scan/containers.db)
# Environment variable: DB_PATH
db_path=/var/lib/bjorn2scan/containers.db

# Enable debug mode (default: false)
# When enabled, adds /debug/sql and /debug/metrics endpoints
# WARNING: Only enable in development/testing - NOT for production
# Environment variable: DEBUG_ENABLED
debug_enabled=false

# ============================================================================
# AUTO-UPDATE CONFIGURATION
# ============================================================================

# Enable automatic updates (default: true)
# When enabled, agent will periodically check for new versions and auto-update
auto_update_enabled=true

# Update check interval (default: 6h)
# Format: Go duration string (e.g., "6h", "24h", "30m")
auto_update_check_interval=1h

# Allow automatic minor version updates (default: true)
# Example: 0.1.x → 0.2.x
auto_update_minor_versions=true

# Allow automatic major version updates (default: false)
# Example: 0.x.x → 1.x.x
auto_update_major_versions=false

# Pin to a specific version (default: empty = auto-update)
# When set, only this version will be installed
# Example: auto_update_pinned_version=0.1.35
auto_update_pinned_version=

# Minimum allowed version (default: empty = no minimum)
# Will not downgrade below this version
auto_update_min_version=

# Maximum allowed version (default: empty = no maximum)
# Will not upgrade above this version
auto_update_max_version=

# GitHub repository for updates (default: bvboe/b2s-go)
# Format: owner/repo
update_github_repo=bvboe/b2s-go

# Verify signatures before installing (default: false)
# TODO: Enable when cosign verification is implemented
update_verify_signatures=false

# Enable automatic rollback on failure (default: true)
# If health check fails after update, automatically rollback to previous version
update_rollback_enabled=true

# Health check timeout after update (default: 60s)
# Format: Go duration string or integer seconds
update_health_check_timeout=60s

# Cosign identity regexp for signature verification
update_cosign_identity_regexp=https://github.com/bvboe/b2s-go/*

# Cosign OIDC issuer for signature verification
update_cosign_oidc_issuer=https://token.actions.githubusercontent.com

# ============================================================================
# SCHEDULED JOBS CONFIGURATION
# ============================================================================

# Enable scheduled jobs system (default: true)
# When disabled, all jobs below will be inactive
jobs_enabled=true

# --- Refresh Images Job ---
# Periodically reconciles running containers with the database
# This ensures the database stays synchronized with actual workloads

# Enable refresh images job (default: true)
jobs_refresh_images_enabled=true

# How often to run the refresh job (default: 6h)
# Format: Go duration string (e.g., "6h", "12h", "24h")
jobs_refresh_images_interval=6h

# Maximum execution time for refresh job (default: 10m)
jobs_refresh_images_timeout=10m

# --- Cleanup Job ---
# Removes orphaned container images and related data from the database
# Keeps the database lean by cleaning up images no longer in use

# Enable cleanup job (default: true)
jobs_cleanup_enabled=true

# How often to run the cleanup job (default: 24h)
# Format: Go duration string (e.g., "24h", "48h", "7d")
jobs_cleanup_interval=24h

# Maximum execution time for cleanup job (default: 1h)
jobs_cleanup_timeout=1h

# --- Future Jobs ---
# Additional scheduled jobs can be configured here as they are implemented
# Examples:
# jobs_rescan_database_enabled=false
# jobs_rescan_database_interval=1h
# jobs_rescan_database_timeout=30m
#
# jobs_telemetry_enabled=false
# jobs_telemetry_interval=5m
# jobs_telemetry_jitter=2m
# jobs_telemetry_timeout=30s
